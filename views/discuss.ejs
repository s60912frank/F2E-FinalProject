<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Discuss</title>
</head>
<body>
  <h1>嗨! <span id="userName"><%= user.name %></span>! 準備好嘴砲了嗎?</h1>
  <p>你現在的身分是:<%= user.nickname %></p>
  <input type="text" id="nicknameText">
  <button id="changeNickname">更改暱稱</button>

  <button id="logout">登出</button>
  <!--只有是管理者才會出現這個按鈕-->
  <%if (user.isAdmin) { %>
    <a href="./admin"><button>後臺管理</button></a>
  <% } %>

  <div>
    增加主題: <input type="text" id="topicText">
    <button id="addTopic">送出</button>
  </div>

  <!--把話題跟留言全部塞進來-->
  <%if (topics) { %>
    <% for(var i = topics.length - 1; i >= 0; i--) {%>
     <div>
       <h2 class="topicTitle"><%= topics[i].name %></h2>
       <ul>
         <% for(var j = topics[i].comments.length - 1; j >= 0; j--) {%>
           <% var date = topics[i].comments[j].time
              if(topics[i].comments[j].comment.indexOf(".jpg") != -1 ||
                 topics[i].comments[j].comment.indexOf(".png") != -1) { %>
                <a href=<%= topics[i].comments[j].comment %>>
                  <img src=<%= topics[i].comments[j].comment %> alt="" style="max-width: 400px">
                </a>
           <% } %>
           <% if(topics[i].comments[j].comment.indexOf("www.youtube.com") != -1){
             var text = topics[i].comments[j].comment
             var vid = text.substring(text.indexOf("?v=") + 3, text.length);
             var embedUrl = "https://www.youtube.com/embed/" + vid + "?rel=0" %>
             <iframe width="560" height="315" src=<%= embedUrl %> frameborder="0" allowfullscreen></iframe>
           <% } %>
           <li><%= topics[i].comments[j].name + ':' + topics[i].comments[j].comment + '@' +
               date.getFullYear() + '/' + (date.getMonth() + 1) + '/' + date.getDate() + ' ' +
               date.getHours() + ":" + date.getMinutes() %></li>
         <% } %>

       </ul>
       <input type="text" class="commentText">
       <button class="sendComment">回應</button>
     </div>
    <% } %>
  <% } %>

  <script src="./js/jquery-2.2.4.min.js"></script>
  <script src="./js/discuss.js"></script>
</body>
</html>
